{% extends "index.html" %}

{% block title %}로그인 | 이화마켓{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="css/login.css">
{% endblock %}
    

{% block section %}
    <main class="main-content">
        <div class="login-container card">
            <h2 class="login-title">로그인</h2>
            <form>
                <div class="form-group">
                    <input class="form-input" type="text" placeholder="아이디">
                </div>
                <div class="form-group">
                    <input class="form-input" type="password" placeholder="비밀번호">
                 </div>
                  <button class="btn btn-green btn-full btn-large">로그인</button>
        <p class="signup-link">계정이 없으신가요? <a href="signup.html">회원가입</a></p>
            </form>
        </div>
    </main>
{% endblock %}

{% with mesg = get_flashed_messages() %}
  {% if mesg %}
    <script>alert("{{ mesg[0] }}")</script>
  {% endif %}
{% endwith %}


<main class="main-content">
  <div class="login-container card">
    <h2 class="login-title">로그인</h2>

    
    <form id="login-form" method="POST" >
      <div class="form-group">
        <input id = "user-id" class="form-input" type="text" name="id" placeholder="아이디" required>
      </div>
      <div class="form-group">
        <input id="user-pw" class="form-input" type="password" name="pw" placeholder="비밀번호" required>
      </div>

     
      <button class="btn btn-green btn-full btn-large" type="submit">로그인</button>
      <p class="signup-link">
        계정이 없으신가요? <a href="/signup.html">회원가입</a>
      </p>
    </form>
  </div>
</main>

<script>
    // 로그인 폼 제출 핸들러
    document.getElementById("login-form").addEventListener("submit", async function (e) {
        e.preventDefault(); // 기본 폼 제출 방지

        const id = document.getElementById("user-id").value.trim();
        const pw = document.getElementById("user-pw").value.trim();

        if (!id || !pw) {
            alert("아이디와 비밀번호를 모두 입력하세요.");
            return;
        }

        try {
            // 백엔드 API 호출 (회원가입처럼 /api/... 경로 명시)
            const resp = await fetch('/api/login_confirm', {
                method: "POST",
                headers: {
                    "Accept": "application/json"
                },
                body: new URLSearchParams({ id, pw })  // FormData 대신 간단히 전송
            });

            const data = await resp.json();

            if (resp.ok && data.success) {
                alert("로그인 성공! 상품 목록으로 이동합니다.");
                window.location.href = "/product-list.html";
            } else {
                alert("아이디 또는 비밀번호를 다시 확인하세요.");
            }

        } catch (error) {
            console.error("로그인 요청 오류:", error);
            alert("서버 오류가 발생했습니다. 잠시 후 다시 시도하세요.");
        }
    });
</script>
</body>

   
</body>

