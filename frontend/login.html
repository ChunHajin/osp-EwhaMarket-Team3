<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>로그인 | 이화마켓</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="css/login.css">
</head>

<body>
  <!-- 공용 아이콘 심볼 -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">

    <!-- 찜 (Heart) -->
    <symbol id="icon-heart" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364
           l7.682-7.682a4.5 4.5 0 00-6.364-6.364
           L12 7.636l-1.318-1.318a4.5 4.5 0
           00-6.364 0z" />
    </symbol>

    <!-- 사용자 (User) -->
    <symbol id="icon-user" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0z
           M12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
    </symbol>

  </svg>
  <header class="header">
    <div class="container header-inner">
      <div class="logo-group">
        <div class="logo-icon-wrapper"><span>E</span></div>
        <h1 class="logo-text">이화마켓</h1>
      </div>
      <nav class="header-nav">
        <button class="btn btn-green">판매하기</button>
        <button class="btn btn-white">찜</button>
        <button class="header-icon-button">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <use href="#icon-user"></use>
          </svg>
        </button>
      </nav>
    </div>
  </header>
    
{% with mesg = get_flashed_messages() %}
  {% if mesg %}
    <script>alert("{{ mesg[0] }}")</script>
  {% endif %}
{% endwith %}


<main class="main-content">
  <div class="login-container card">
    <h2 class="login-title">로그인</h2>

    
    <form id="login-form" method="POST" >
      <div class="form-group">
        <input id = "user-id" class="form-input" type="text" name="id" placeholder="아이디" required>
      </div>
      <div class="form-group">
        <input id="user-pw" class="form-input" type="password" name="pw" placeholder="비밀번호" required>
      </div>

     
      <button class="btn btn-green btn-full btn-large" type="submit">로그인</button>
      <p class="signup-link">
        계정이 없으신가요? <a href="/signup.html">회원가입</a>
      </p>
    </form>
  </div>
</main>

<script>
    // 로그인 폼 제출 핸들러
    document.getElementById("login-form").addEventListener("submit", async function (e) {
        e.preventDefault(); // 기본 폼 제출 방지

        const id = document.getElementById("user-id").value.trim();
        const pw = document.getElementById("user-pw").value.trim();

        if (!id || !pw) {
            alert("아이디와 비밀번호를 모두 입력하세요.");
            return;
        }

        try {
            // 백엔드 API 호출 (회원가입처럼 /api/... 경로 명시)
            const resp = await fetch('/api/login_confirm', {
                method: "POST",
                headers: {
                    "Accept": "application/json"
                },
                body: new URLSearchParams({ id, pw })  // FormData 대신 간단히 전송
            });

            const data = await resp.json();

            if (resp.ok && data.success) {
                alert("로그인 성공! 상품 목록으로 이동합니다.");
                window.location.href = "/product-list.html";
            } else {
                alert("아이디 또는 비밀번호를 다시 확인하세요.");
            }

        } catch (error) {
            console.error("로그인 요청 오류:", error);
            alert("서버 오류가 발생했습니다. 잠시 후 다시 시도하세요.");
        }
    });
</script>
</body>

   
</body>