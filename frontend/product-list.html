{% extends "index.html" %}

{% block title %}상품 목록 | 이화마켓{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="css/product-list.css">
{% endblock %}

{% block section %}
  <main class="main-content">
    <h2 class="page-title">지금 이화에는 이런 상품들이 있어요!</h2>

    <div class="category-filter">
      {% set cats = ['전체','전공서적','전자기기','생활용품','의류/잡화'] %}
      {% for c in cats %}
        <a href="{{ url_for('product_list', category=c) }}" class="btn-pill {{ 'btn-pill-active' if (selected_category == c) else 'btn-pill-inactive' }}">{{ c }}</a>
      {% endfor %}
    </div>

    <div class="product-grid">
      {% if total > 0 %}
        {% for key, value in datas %}
          
            {% set is_sold = (value.status | default('') | trim) == '거래 완료' %}
            <a href="{{ url_for('product_detail', name=key) }}" style="text-decoration: none; color: inherit;">
              <div class="product-card {{ 'product-card--sold' if is_sold else '' }}">
              
              <div class="product-card-image">
                {% if value.img_path %}
                  <img src="{{ value.img_path }}" alt="{{ value.title }}" style="width:100%; height:100%; object-fit:cover;">
                {% endif %}
              </div>
              
              <div class="product-card-content">
                {% set status_class = 'tag-status-used' %}
                {% if value.status == "상태 최상" %}
                  {% set status_class = 'tag-status-great' %}
                {% elif value.status == "약간의 하자" %}
                  {% set status_class = 'tag-status-defect' %}
                {% endif %}

                {% set display_status = value.status | default('상태 없음') %}
                {% if (value.status | default('') | trim) == '거래 완료' %}
                  {% set display_status = '거래 완료' %}
                {% endif %}

                <span class="tag-status {{ status_class }}">
                  {{ display_status }}
                </span>
                
                <h3 class="product-title">{{ value.title | default(key) }}</h3>   
                             
                <div>
                  {% if value.region %}<span class="tag-info">#{{ value.region }}</span>{% endif %}
                  {% if value.trade_method %}<span class="tag-info">#{{ value.trade_method }}</span>{% endif %}
                </div>

                <div class="product-meta-row">
                  <p class="product-price">{{ value.price | default(0) | int }}원</p>
                  {% set li = like_info.get(key, {'liked': False, 'count': 0}) %}
                  <div class="like-info {% if li.liked is true %}liked{% endif %}" data-item-name="{{ key }}">
                    <svg viewBox="0 0 24 24" class="like-icon" fill="none" stroke="currentColor">
                      <use href="{% if li.liked is true %}#icon-heart-filled{% else %}#icon-heart{% endif %}"></use>
                    </svg>
                    <span class="like-count">{{ li.count }}</span>
                  </div>
                </div>
              </div>
            </div>
            </a>
          {% endfor %}
      
      {% else %}
        <p style="text-align: center; grid-column: 1 / -1;">등록된 상품이 없습니다.</p>
      {% endif %}
      
    </div>

    <div class="pagination">
      <nav aria-label="Page navigation">
        <ul class="pagination-list">
          {% for i in range(1, page_count + 1) %}
          <li>
            <a href="{{ url_for('product_list', page=i, category=selected_category) }}" class="{{ 'active' if i == page else '' }}">
              {{ i }} </a>
          </li>
          {% endfor %}
        </ul>
      </nav>
    </div>
  </main>
{% endblock %}